{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\blelm\\\\Desktop\\\\AppCreate\\\\habitPlan\\\\src\\\\components\\\\test\\\\firebaseTest\\\\FirebaseAuthComponent.tsx\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from \"react\";\nimport { firebase } from \"./firebaseTest\";\nimport { logout } from \"../../../modules/userModule\";\nimport { allDelete } from \"../../../modules/tasksModule\";\nimport { useSelector, useDispatch } from \"react-redux\";\n\nconst useReduxFetch = () => {\n  const dispatch = useDispatch();\n  return dispatch;\n}; // ログイン、ログアウトボタン実装\n\n\nexport default function FirebaseAuthComponent() {\n  const loggedin = useFirebaseLogin();\n  const dispatch = useReduxFetch();\n\n  if (!loggedin) {\n    // ログインしていなければログインボタンを表示\n    return __jsx(\"button\", {\n      onClick: () => signInWithPopup(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 21,\n        columnNumber: 16\n      }\n    }, \"\\u30ED\\u30B0\\u30A4\\u30F3\");\n  } // ログインしているならログアウトボタンを表示\n\n\n  return __jsx(\"button\", {\n    onClick: () => signOut(dispatch),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24,\n      columnNumber: 12\n    }\n  }, \"\\u30ED\\u30B0\\u30A2\\u30A6\\u30C8\");\n} // ログイン処理\n\nexport const signInWithPopup = () => {\n  // Googleプロバイダオブジェクトのインスタンスを作成\n  const googleAuthProvider = new firebase.auth.GoogleAuthProvider(); // dispatch(login(userIdCheck));\n  // 別タブでログイン画面に飛ばしたいため、signInWithPopupを使う\n  // リダイレクトでログイン画面に飛ばしたい場合はsignInWithRedirectを使う\n\n  firebase.auth().signInWithPopup(googleAuthProvider); // return firebase.auth().signInWithPopup(googleAuthProvider);\n};\nexport const signInWithEmailAndPassword = (email, password) => {\n  console.log(email);\n  console.log(password);\n  firebase.auth().signInWithEmailAndPassword(email, password).catch(function (error) {\n    // Handle Errors here.\n    const errorCode = error.code;\n    console.log(error.code);\n    const errorMessage = error.message;\n    console.log(error.message);\n\n    if (errorCode == 'auth/user-not-found') {\n      firebase.auth().createUserWithEmailAndPassword(email, password);\n    }\n  });\n}; // ログアウト処理\n\nexport const signOut = dispatch => {\n  // signOutを呼び出すだけでOK\n  // const dispatch = useReduxFetch();\n  dispatch(logout());\n  dispatch(allDelete());\n  return firebase.auth().signOut();\n}; // ログインしているかチェックするカスタムフックを作る\n\nconst useFirebaseLogin = () => {\n  // stateでログイン状態を保持\n  const {\n    0: loggedin,\n    1: setLoggedin\n  } = useState(false);\n  const dispatch = useReduxFetch();\n  const {\n    userTaskInfo\n  } = useSelector(state => state.tasks);\n  useEffect(() => {\n    // 現在ログインしているユーザを取得\n    firebase.auth().onAuthStateChanged(user => {\n      // ユーザ情報が取れればログイン状態\n      let userIdCheck;\n      console.log(\"FAC !!user\");\n      console.log(!!user);\n\n      if (!!user) {\n        userIdCheck = user.uid; // console.log('data');\n        // console.log(data);\n        // dispatch(init(data));\n\n        console.log(\"FAC userTaskInfo.calendar[0].PatternId\"); // console.log(userTaskInfo.calendar[0].PatternId);\n        // これをreduxで管理する\n        // dispatch(login(userIdCheck));\n      }\n\n      setLoggedin(!!user);\n    });\n  }, []); // ログイン情報を返却\n\n  return loggedin;\n};","map":{"version":3,"sources":["C:/Users/blelm/Desktop/AppCreate/habitPlan/src/components/test/firebaseTest/FirebaseAuthComponent.tsx"],"names":["React","useState","useEffect","firebase","logout","allDelete","useSelector","useDispatch","useReduxFetch","dispatch","FirebaseAuthComponent","loggedin","useFirebaseLogin","signInWithPopup","signOut","googleAuthProvider","auth","GoogleAuthProvider","signInWithEmailAndPassword","email","password","console","log","catch","error","errorCode","code","errorMessage","message","createUserWithEmailAndPassword","setLoggedin","userTaskInfo","state","tasks","onAuthStateChanged","user","userIdCheck","uid"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { firebase } from \"./firebaseTest\";\r\nimport { login, logout } from \"../../../modules/userModule\";\r\nimport { init, allDelete } from \"../../../modules/tasksModule\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { RootState } from \"../../../modules/rootReducer\";\r\nimport { useFetchAllData } from \"./DBFetch\";\r\nimport { Dispatch } from \"@reduxjs/toolkit\";\r\n\r\nconst useReduxFetch = () => {\r\n    const dispatch = useDispatch();\r\n    return dispatch;\r\n};\r\n\r\n// ログイン、ログアウトボタン実装\r\nexport default function FirebaseAuthComponent() {\r\n    const loggedin = useFirebaseLogin();\r\n    const dispatch = useReduxFetch();\r\n    if (!loggedin) {\r\n        // ログインしていなければログインボタンを表示\r\n        return <button onClick={() => signInWithPopup()}>ログイン</button>;\r\n    }\r\n    // ログインしているならログアウトボタンを表示\r\n    return <button onClick={() => signOut(dispatch)}>ログアウト</button>;\r\n}\r\n\r\n// ログイン処理\r\nexport const signInWithPopup = () => {\r\n    // Googleプロバイダオブジェクトのインスタンスを作成\r\n    const googleAuthProvider = new firebase.auth.GoogleAuthProvider();\r\n\r\n    // dispatch(login(userIdCheck));\r\n    // 別タブでログイン画面に飛ばしたいため、signInWithPopupを使う\r\n    // リダイレクトでログイン画面に飛ばしたい場合はsignInWithRedirectを使う\r\n    firebase.auth().signInWithPopup(googleAuthProvider);\r\n    // return firebase.auth().signInWithPopup(googleAuthProvider);\r\n};\r\n\r\nexport const signInWithEmailAndPassword = (email: string, password: string) => {\r\n    console.log(email);\r\n    console.log(password);\r\n    firebase\r\n        .auth()\r\n        .signInWithEmailAndPassword(email, password)\r\n        .catch(function (error) {\r\n            // Handle Errors here.\r\n            const errorCode = error.code;\r\n            console.log(error.code);\r\n            const errorMessage = error.message;\r\n            console.log(error.message);\r\n            if(errorCode == 'auth/user-not-found'){\r\n                firebase.auth().createUserWithEmailAndPassword(email, password);\r\n            }\r\n        });\r\n};\r\n\r\n// ログアウト処理\r\nexport const signOut = (dispatch: Dispatch<any>) => {\r\n    // signOutを呼び出すだけでOK\r\n    // const dispatch = useReduxFetch();\r\n    dispatch(logout());\r\n    dispatch(allDelete());\r\n    return firebase.auth().signOut();\r\n};\r\n\r\n// ログインしているかチェックするカスタムフックを作る\r\nconst useFirebaseLogin = () => {\r\n    // stateでログイン状態を保持\r\n    const [loggedin, setLoggedin] = useState(false);\r\n    const dispatch = useReduxFetch();\r\n\r\n    const { userTaskInfo } = useSelector((state: RootState) => state.tasks);\r\n\r\n    useEffect(() => {\r\n        // 現在ログインしているユーザを取得\r\n        firebase.auth().onAuthStateChanged((user) => {\r\n            // ユーザ情報が取れればログイン状態\r\n            let userIdCheck: string;\r\n            console.log(\"FAC !!user\");\r\n            console.log(!!user);\r\n            if (!!user) {\r\n                userIdCheck = user.uid;\r\n                // console.log('data');\r\n                // console.log(data);\r\n                // dispatch(init(data));\r\n                console.log(\"FAC userTaskInfo.calendar[0].PatternId\");\r\n                // console.log(userTaskInfo.calendar[0].PatternId);\r\n                // これをreduxで管理する\r\n                // dispatch(login(userIdCheck));\r\n            }\r\n\r\n            setLoggedin(!!user);\r\n        });\r\n    }, []);\r\n    // ログイン情報を返却\r\n    return loggedin;\r\n};\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"// データベースへの接続\nimport firebase from \"firebase/app\"; // 認証周りやDB周りで必要なためimportしておく\n\nimport \"firebase/auth\";\nimport \"firebase/database\";\nimport { useMemo, useState, useEffect } from \"react\"; // カスタムフックにしておく\n\nconst useDatabase = () => {\n  // 同じパスでは毎回同じ結果が得られるのでmemo化しておく\n  return useMemo(() => firebase.database().ref(\"/sample\"), []);\n}; //   データを取得する\n// hooksを使いたいのでカスタムhooksにしておく\n\n\nconst useFetchData = ref => {\n  const {\n    0: data,\n    1: setData\n  } = useState();\n  useEffect(() => {\n    // イベントリスナーを追加するにはonを使う\n    ref.on(\"value\", snapshot => {\n      // パスに対する全データを含むsnapshotが渡される\n      // ない場合はnullが変えるので存在をチェックしておく\n      if (snapshot === null || snapshot === void 0 ? void 0 : snapshot.val()) {\n        setData(snapshot.val());\n      }\n    });\n    return () => {\n      ref.off();\n    }; // refの変更に応じて再取得する\n    //   指定したパスのデータに対する更新をすべて検知するにはvalueを指定すれば良い。\n  }, [ref]); // データを返却する\n\n  return {\n    data\n  };\n}; // 実際に呼び出す際はこちらを使う\n\n\nexport const useFetchAllData = () => {\n  // refを取得して\n  const ref = useDatabase(); // ref渡してデータを取得する\n\n  return useFetchData(ref);\n};","map":{"version":3,"sources":["C:/Users/blelm/Desktop/AppCreate/habitPlan/src/components/test/firebaseTest/DBFetch.tsx"],"names":["firebase","useMemo","useState","useEffect","useDatabase","database","ref","useFetchData","data","setData","on","snapshot","val","off","useFetchAllData"],"mappings":"AAAA;AAEA,OAAOA,QAAP,MAAqB,cAArB,C,CACA;;AACA,OAAO,eAAP;AACA,OAAO,mBAAP;AACA,SAASC,OAAT,EAAkBC,QAAlB,EAA4BC,SAA5B,QAA6C,OAA7C,C,CAEA;;AACA,MAAMC,WAAW,GAAG,MAAM;AACtB;AACA,SAAOH,OAAO,CAAC,MAAMD,QAAQ,CAACK,QAAT,GAAoBC,GAApB,CAAwB,SAAxB,CAAP,EAA2C,EAA3C,CAAd;AACH,CAHD,C,CAKA;AACA;;;AACA,MAAMC,YAAY,GAAID,GAAD,IAAsC;AACvD,QAAM;AAAA,OAACE,IAAD;AAAA,OAAOC;AAAP,MAAkBP,QAAQ,EAAhC;AACAC,EAAAA,SAAS,CAAC,MAAM;AACZ;AACAG,IAAAA,GAAG,CAACI,EAAJ,CAAO,OAAP,EAAiBC,QAAD,IAAc;AAC1B;AACA;AACA,UAAIA,QAAJ,aAAIA,QAAJ,uBAAIA,QAAQ,CAAEC,GAAV,EAAJ,EAAqB;AACjBH,QAAAA,OAAO,CAACE,QAAQ,CAACC,GAAT,EAAD,CAAP;AACH;AACJ,KAND;AAOA,WAAO,MAAM;AACTN,MAAAA,GAAG,CAACO,GAAJ;AACH,KAFD,CATY,CAYZ;AACA;AACH,GAdQ,EAcN,CAACP,GAAD,CAdM,CAAT,CAFuD,CAiBvD;;AACA,SAAO;AAAEE,IAAAA;AAAF,GAAP;AACH,CAnBD,C,CAqBA;;;AACA,OAAO,MAAMM,eAAe,GAAG,MAAM;AACjC;AACA,QAAMR,GAAG,GAAGF,WAAW,EAAvB,CAFiC,CAGjC;;AACA,SAAOG,YAAY,CAACD,GAAD,CAAnB;AACH,CALM","sourcesContent":["// データベースへの接続\r\n\r\nimport firebase from \"firebase/app\";\r\n// 認証周りやDB周りで必要なためimportしておく\r\nimport \"firebase/auth\";\r\nimport \"firebase/database\";\r\nimport { useMemo, useState, useEffect } from \"react\";\r\n\r\n// カスタムフックにしておく\r\nconst useDatabase = () => {\r\n    // 同じパスでは毎回同じ結果が得られるのでmemo化しておく\r\n    return useMemo(() => firebase.database().ref(\"/sample\"), []);\r\n};\r\n\r\n//   データを取得する\r\n// hooksを使いたいのでカスタムhooksにしておく\r\nconst useFetchData = (ref: firebase.database.Reference) => {\r\n    const [data, setData] = useState<{ [key: string]: string }>();\r\n    useEffect(() => {\r\n        // イベントリスナーを追加するにはonを使う\r\n        ref.on(\"value\", (snapshot) => {\r\n            // パスに対する全データを含むsnapshotが渡される\r\n            // ない場合はnullが変えるので存在をチェックしておく\r\n            if (snapshot?.val()) {\r\n                setData(snapshot.val());\r\n            }\r\n        });\r\n        return () => {\r\n            ref.off();\r\n        };\r\n        // refの変更に応じて再取得する\r\n        //   指定したパスのデータに対する更新をすべて検知するにはvalueを指定すれば良い。\r\n    }, [ref]);\r\n    // データを返却する\r\n    return { data };\r\n};\r\n\r\n// 実際に呼び出す際はこちらを使う\r\nexport const useFetchAllData = () => {\r\n    // refを取得して\r\n    const ref = useDatabase();\r\n    // ref渡してデータを取得する\r\n    return useFetchData(ref);\r\n};"]},"metadata":{},"sourceType":"module"}